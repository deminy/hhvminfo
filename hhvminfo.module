<?php

/**
 * @file
 * Display phpinfo for HHVM HipHop Virtual Machine.
 */

/**
 * Implements hook_theme().
 */
function hhvminfo_theme() {
  return array(
    'hhvminfo_phpinfo' => array(
      'template' => 'hhvminfo',
    ),
  );
}

/**
 * Implements hook_menu_alter().
 *
 * @see system_menu()
 */
function hhvminfo_menu_alter(array &$items) {
  $path = 'admin/reports/status/php';
  if (array_key_exists($path, $items)) {
    $items[$path]['page callback'] = '_hhvminfo_phpinfo';
    unset($items[$path]['file']);
  }
}

/**
 * Display phpinfo for HHVM, or use phpinfo() directly if not under HHVM.
 */
function _hhvminfo_phpinfo() {
  if (php_sapi_name() == 'srv') {
    print theme('hhvminfo_phpinfo');

    drupal_exit();
  }
  else {
    system_php();
  }
}
